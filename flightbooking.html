<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iberia VA - Book Flight</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Poppins for headings, Inter for body -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://ik.imagekit.io/hswtnwf8i/iberia%20colors.png?updatedAt=1753001611287" type="image/png">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth; /* Smooth scrolling for navigation */
            background-color: #0F172A; /* Slate-900 for a dark theme */
            color: #E2E8F0; /* Slate-200 for text */
            /* Background image for the entire body */
            background-image: url('https://ik.imagekit.io/hswtnwf8i/a320%20beria.png?updatedAt=1752938799277');
            background-size: cover; /* Cover the entire viewport */
            background-position: center; /* Center the background image */
            background-attachment: fixed; /* Keep the background fixed during scroll */
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            color: #F8FAFC; /* White for headings */
        }
        /* Custom styles for hero section background overlay */
        .hero-overlay {
            /* Adjusted for better visibility with a background image */
            background-image: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%);
        }
        /* Style for scroll-to-top button */
        #scrollToTopBtn {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed position */
            bottom: 20px; /* Place at the bottom */
            right: 20px; /* Place at the right */
            z-index: 100; /* High z-index to be on top */
            background-color: #DC2626; /* Red-600 */
            color: white;
            padding: 12px 18px;
            border-radius: 9999px; /* Fully rounded */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, transform 0.3s ease;
            cursor: pointer;
        }
        #scrollToTopBtn:hover {
            background-color: #B91C1C; /* Red-700 */
            transform: translateY(-3px);
        }
        /* Basic icon styling for SVG consistency */
        .icon-lg {
            width: 4rem; /* 64px */
            height: 4rem; /* 64px */
        }
        /* Card hover effect */
        .card-hover-effect {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover-effect:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
        /* Button hover effect */
        .btn-primary {
            background-color: #DC2626; /* Red-600 */
            color: white;
            font-weight: bold;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #B91C1C; /* Red-700 */
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }
        /* Discord Login Button and User Info Styling */
        .discord-login-btn {
            @apply flex items-center justify-center space-x-2 px-6 py-3 rounded-full text-base font-semibold; /* Increased padding and font size */
            background-color: #5865F2; /* Discord Blue */
            color: white;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Stronger shadow */
        }
        .discord-login-btn:hover {
            background-color: #4752C4; /* Darker Discord Blue */
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Stronger hover shadow */
        }
        .discord-login-btn svg {
            @apply w-6 h-6; /* Larger icon */
        }
          .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #E2E8F0; /* Slate-200 */
            font-weight: 600;
        }
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #DC2626; /* Red-600 */
        }
        .logout-button {
            background-color: #DC2626; /* Red-600 */
            color: white;
            padding: 0.5rem 1.2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .logout-button:hover {
            background-color: #B91C1C; /* Red-700 */
        }

        /* From Uiverse.io by vinodjangid07 */ 
        .Btn {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background-color: transparent;
            position: relative;
            /* overflow: hidden; */
            border-radius: 7px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .svgContainer {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            backdrop-filter: blur(0px);
            letter-spacing: 0.8px;
            border-radius: 10px;
            transition: all 0.3s;
            border: 1px solid rgba(156, 156, 156, 0.466);
        }

        .BG {
            position: absolute;
            content: "";
            width: 100%;
            height: 100%;
            background: #7289da;
            z-index: -1;
            border-radius: 10px;
            pointer-events: none;
            transition: all 0.3s;
        }

        .Btn:hover .BG {
            transform: rotate(35deg);
            transform-origin: bottom;
        }

        .Btn:hover .svgContainer {
            border: 1px solid rgba(206, 206, 206, 0.466);
            background-color: rgba(214, 214, 214, 0.466);
            backdrop-filter: blur(4px);
        }

        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0F172A; /* Dark background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* High z-index to cover everything */
            flex-direction: column;
            gap: 20px;
        }

        .video-container {
            width: 200px; /* Adjust size as needed */
            height: 200px; /* Adjust size as needed */
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 5px solid #DC2626; /* Red border for emphasis */
        }
        .video-container video { /* Changed from iframe to video */
            display: block; /* Remove extra space below iframe */
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensure video covers the container */
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="video-container">
            <video src="iberia animation.gif" autoplay loop muted playsinline></video>
        </div>
        <p class="text-xl font-semibold text-white">Loading...</p>
    </div>

    <!-- Main Content Wrapper (all existing content goes inside here) -->
    <div id="main-content" style="display: none;">
        <!-- Header -->
        <header class="bg-gray-900 shadow-lg fixed w-full z-10">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <!-- Logo/Brand -->
                <div class="flex items-center">
                    <img src="https://ik.imagekit.io/hswtnwf8i/iberia%20colors.png?updatedAt=1753001611287" alt="Iberia VA Logo" class="h-10 w-auto mr-2"/>
                    <a href="https://pfiberiava.github.io/flyibe/" class="text-2xl font-bold text-white rounded-md hover:text-red-500 transition duration-300">
                        Iberia VA
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="text-lg font-medium text-gray-300 hover:text-red-500 transition duration-300 px-3 py-2 rounded-md">Home</a>
                    <a href="#booking" class="text-lg font-medium text-gray-300 hover:text-red-500 transition duration-300 px-3 py-2 rounded-md">Book a Flight</a>
                    <a href="#contact" class="text-lg font-medium text-gray-300 hover:text-red-500 transition duration-300 px-3 py-2 rounded-md">Contact</a>
                </div>

                <!-- Discord Auth Section for Desktop -->
                <div id="desktop-user-actions" class="user-actions hidden md:flex items-center space-x-2">
                    <!-- Content injected by JS -->
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-red-500 focus:outline-none focus:ring-2 focus:ring-red-500 rounded-md p-2">
                        <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                        <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
            </nav>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="md:hidden hidden bg-gray-800 py-4 shadow-lg">
                <div class="flex flex-col items-center space-y-4">
                    <a href="index.html" class="text-lg font-medium text-gray-300 hover:text-red-500 transition duration-300 w-full text-center py-2 rounded-md" onclick="closeMobileMenu()">Home</a>
                    <a href="#booking" class="text-lg font-medium text-gray-300 hover:text-red-500 transition duration-300 w-full text-center py-2 rounded-md" onclick="closeMobileMenu()">Book a Flight</a>
                    <a href="#contact" class="text-lg font-medium text-gray-300 hover:text-red-500 transition duration-300 w-full text-center py-2 rounded-md" onclick="closeMobileMenu()">Contact</a>
                    <!-- Discord Auth Section for Mobile -->
                    <div id="mobile-user-actions" class="user-actions w-full text-center py-2">
                        <!-- Content injected by JS -->
                    </div>
                </div>
            </div>
        </header>

        <main class="pt-20"> <!-- Padding to account for fixed header -->
            <!-- Flight Booking Section -->
            <section id="booking" class="py-16 bg-slate-900 min-h-screen flex items-center justify-center">
                <div class="container mx-auto px-6 text-center">
                    <h1 class="text-4xl md:text-5xl font-extrabold mb-8 text-white">Book Your Flight with Iberia VA</h1>
                    <p class="text-lg text-gray-300 mb-12 max-w-2xl mx-auto">
                        Search for your perfect route and start your virtual journey with us today.
                    </p>

                    <div class="bg-gray-900 p-8 rounded-lg shadow-xl w-full max-w-3xl mx-auto border border-gray-700" style="background-image: url('https://cdn.discordapp.com/attachments/1360096616454819841/1381007276193874050/image.png?ex=687dfa80&is=687ca900&hm=e95a5bd1855bad213f1c15978d3e506ce77ac547d1882ffd005cc4930725e5e4&'); background-size: cover; background-position: center; background-blend-mode: overlay; background-color: rgba(15, 23, 42, 0.8);">
                        <!-- Message for not logged in users -->
                        <div id="login-required-message" class="text-center p-6 bg-red-800 bg-opacity-70 rounded-lg mb-8 hidden">
                            <h3 class="text-2xl font-bold text-white mb-4">Please Log In to Book Flights</h3>
                            <p class="text-gray-200">You need to be logged in with Discord to access the flight booking system.</p>
                            <div id="login-button-container" class="mt-6 flex justify-center">
                                <!-- Discord login button will be rendered here by JS -->
                            </div>
                        </div>

                        <!-- Flight Booking Form -->
                        <form id="flight-booking-form" action="https://formcarry.com/s/B6IGRQkIQFb" method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                            <!-- Origin Airport -->
                            <div>
                                <label for="origin" class="block text-gray-300 text-sm font-bold mb-2">
                                    Origin Airport (ICAO)
                                </label>
                                <select
                                    id="origin"
                                    name="origin"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                    required
                                >
                                    <option value="">Select an Origin</option>
                                    <!-- Options will be dynamically populated by JavaScript -->
                                </select>
                            </div>

                            <!-- Destination Airport -->
                            <div>
                                <label for="destination" class="block text-gray-300 text-sm font-bold mb-2">
                                    Destination Airport (ICAO)
                                </label>
                                <select
                                    id="destination"
                                    name="destination"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                    required
                                >
                                    <option value="">Select a Destination</option>
                                    <!-- Options will be dynamically populated by JavaScript -->
                                </select>
                            </div>

                            <!-- Departure Date -->
                            <div>
                                <label for="departure-date" class="block text-gray-300 text-sm font-bold mb-2">
                                    Departure Date
                                </label>
                                <input
                                    type="date"
                                    id="departure-date"
                                    name="departure-date"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                    required
                                />
                            </div>

                            <!-- Return Date (Optional) -->
                            <div>
                                <label for="return-date" class="block text-gray-300 text-sm font-bold mb-2">
                                    Return Date (Optional)
                                </label>
                                <input
                                    type="date"
                                    id="return-date"
                                    name="return-date"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                />
                            </div>

                            <!-- Number of Passengers -->
                            <div>
                                <label for="passengers" class="block text-gray-300 text-sm font-bold mb-2">
                                    Number of Passengers
                                </label>
                                <input
                                    type="number"
                                    id="passengers"
                                    name="passengers"
                                    min="1"
                                    value="1"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                    required
                                />
                            </div>

                            <!-- Class -->
                            <div>
                                <label for="class" class="block text-gray-300 text-sm font-bold mb-2">
                                    Class
                                </label>
                                <select
                                    id="class"
                                    name="class"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                >
                                    <option value="economy">Economy</option>
                                    <option value="business">Business</option>
                                    <option value="first">First Class</option>
                                </select>
                            </div>

                            <!-- Hidden fields for Discord user info -->
                            <input type="hidden" id="discord-username" name="Discord Username">
                            <input type="hidden" id="discord-id" name="Discord User ID">

                            <!-- Submit Button -->
                            <div class="md:col-span-2 flex justify-center mt-6">
                                <button
                                    type="submit"
                                    class="btn-primary flex items-center justify-center"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    Book Flight
                                </button>
                            </div>
                        </form>

                        <!-- Booking Success Message (Removed as Formcarry handles it) -->
                        <!-- <div id="booking-success-message" class="mt-12 text-center p-6 bg-green-800 bg-opacity-70 rounded-lg hidden">
                            <h3 class="text-2xl font-bold text-white mb-4">Booking Successful!</h3>
                            <p class="text-gray-200">Your flight booking has been successfully recorded. We will reach you soon!</p>
                        </div> -->
                    </div>
                </div>
            </section>

            <!-- Contact Section -->
            <section id="contact" class="py-16 bg-slate-900">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl font-bold text-white mb-8">Need help?</h2>
                    <p class="text-lg text-gray-300 mb-8">
                        Have inquiries, suggestions, or ready to join our community? We're here to help.
                    </p>
                    <div class="flex justify-center">
                        <form action="https://formcarry.com/s/B6IGRQkIQFb" method="POST" enctype="multipart/form-data" class="bg-gray-900 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700">
                            <div class="mb-6">
                                <label for="name" class="block text-gray-300 text-sm font-bold mb-2 text-left">
                                    Name
                                </label>
                                <input
                                    type="text"
                                    id="name"
                                    name="name"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                    placeholder="Your Name"
                                    required
                                />
                            </div>
                            <div class="mb-6">
                                <label for="email" class="block text-gray-300 text-sm font-bold mb-2 text-left">
                                    Email
                                </label>
                                <input
                                    type="email"
                                    id="email"
                                    name="email"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500"
                                    placeholder="your@example.com"
                                    required
                                />
                            </div>
                            <div class="mb-6">
                                <label for="message" class="block text-gray-300 text-sm font-bold mb-2 text-left">
                                    Message
                                </label>
                                <textarea
                                    id="message"
                                    name="message"
                                    rows="5"
                                    class="shadow appearance-none border border-gray-700 bg-gray-800 rounded-md w-full py-3 px-4 text-white leading-tight focus:outline-none focus:ring-2 focus:ring-red-500 resize-y"
                                    placeholder="Your message here..."
                                    required
                                ></textarea>
                            </div>
                            <div class="flex items-center justify-center">
                                <button
                                    type="submit"
                                    class="btn-primary flex items-center"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.29 6.76a2 2 0 0 1-2.42 0L2 7"/></svg>
                                    Send Message
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </main>

        <!-- Scroll to Top Button -->
        <button id="scrollToTopBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>
        </button>

        <!-- Footer -->
        <footer class="bg-gray-950 text-gray-400 py-8">
            <div class="container mx-auto px-6 text-center">
                <p class="mb-4">© <span id="current-year"></span> Iberia VA. All rights reserved.</p>
                <div class="flex justify-center space-x-6">
                    <a href="https://www.instagram.com/iberiava_pf/" class="hover:text-white transition duration-300">Instagram</a>
                    <a href="https://www.youtube.com/channel/UCahgitUZD7SNT2pVCie3ymQ" class="hover:text-white transition duration-300">Youtube</a>
                    <a href="https://discord.gg/vcfDHnpK22" class="hover:text-white transition duration-300">Discord</a>
                </div>
            </div>
        </footer>
    </div> <!-- End of main-content wrapper -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get the current year for the footer
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Mobile menu toggle logic
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');
            const closeIcon = document.getElementById('close-icon');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                menuIcon.classList.toggle('hidden');
                closeIcon.classList.toggle('hidden');
            });

            // Function to close mobile menu when a link is clicked
            function closeMobileMenu() {
                mobileMenu.classList.add('hidden');
                menuIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            }

            // Scroll to top button logic
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');

            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() { scrollFunction() };

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    scrollToTopBtn.style.display = "block";
                } else {
                    scrollToTopBtn.style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Loading Screen Logic
            const loadingScreen = document.getElementById('loading-screen');
            const mainContent = document.getElementById('main-content');
            // The video is short, around 5-6 seconds. Set a timeout slightly longer.
            const videoDurationMs = 6500; // 6.5 seconds

            // Hide main content initially
            mainContent.style.display = 'none';

            // After the estimated video duration, hide the loading screen and show main content
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
            }, videoDurationMs);


            // Flight data based on your provided routes
            const availableFlights = [
                // Long Routes (A350 or A320)
                { flightNumber: 'IB 401', origin: 'MDST', destination: 'LCLK', originName: 'Santiago - Cibao Intl.', destinationName: 'Larnaca, Cyprus', aircraft: 'Airbus A350 or A320', departureTime: '10:00 UTC', arrivalTime: '20:00 UTC', price: 650 },
                { flightNumber: 'IB 402', origin: 'MDPC', destination: 'EFKT', originName: 'Punta Cana Intl.', destinationName: 'Kittilä, Finland', aircraft: 'Airbus A350 or A320', departureTime: '12:00 UTC', arrivalTime: '22:00 UTC', price: 700 },
                // Mid Routes (A320 or B757)
                { flightNumber: 'IB 201', origin: 'MDST', destination: 'GCLP', originName: 'Santiago - Cibao Intl.', destinationName: 'Gran Canaria', aircraft: 'Airbus A320 or Boeing 757', departureTime: '08:00 UTC', arrivalTime: '14:00 UTC', price: 300 },
                { flightNumber: 'IB 202', origin: 'GCLP', destination: 'LEMH', originName: 'Gran Canaria', destinationName: 'Menorca', aircraft: 'Airbus A320 or Boeing 757', departureTime: '11:00 UTC', arrivalTime: '13:30 UTC', price: 180 },
                { flightNumber: 'IB 203', origin: 'GCLP', destination: 'EGKK', originName: 'Gran Canaria', destinationName: 'London Gatwick', aircraft: 'Airbus A320 or Boeing 757', departureTime: '15:00 UTC', arrivalTime: '19:00 UTC', price: 250 },
                { flightNumber: 'IB 204', origin: 'GCLP', destination: 'MDPC', originName: 'Gran Canaria', destinationName: 'Punta Cana', aircraft: 'Airbus A320 or Boeing 757', departureTime: '09:30 UTC', arrivalTime: '17:30 UTC', price: 450 },
                { flightNumber: 'IB 205', origin: 'GCLP', destination: 'LCLK', originName: 'Gran Canaria', destinationName: 'Larnaca', aircraft: 'Airbus A320 or Boeing 757', departureTime: '13:00 UTC', arrivalTime: '20:00 UTC', price: 400 },
            ];

            const flightBookingForm = document.getElementById('flight-booking-form');
            // const bookingSuccessMessageDiv = document.getElementById('booking-success-message'); // Removed
            const loginRequiredMessage = document.getElementById('login-required-message');
            const loginButtonContainer = document.getElementById('login-button-container');
            const originSelect = document.getElementById('origin'); 
            const destinationSelect = document.getElementById('destination');
            const formInputs = flightBookingForm ? flightBookingForm.querySelectorAll('input, select, button[type="submit"]') : [];

            // Get hidden input fields for Discord user info
            const discordUsernameInput = document.getElementById('discord-username');
            const discordIdInput = document.getElementById('discord-id');

            // Function to enable/disable form fields
            function toggleFormFields(enable) {
                formInputs.forEach(input => {
                    input.disabled = !enable;
                    // Optionally change appearance for disabled fields
                    if (!enable) {
                        input.classList.add('opacity-50', 'cursor-not-allowed');
                    } else {
                        input.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                });
            }

            // Function to populate origin dropdown
            function populateOriginDropdown() {
                const uniqueOrigins = new Map();
                availableFlights.forEach(flight => {
                    uniqueOrigins.set(flight.origin, flight.originName);
                });

                originSelect.innerHTML = '<option value="">Select an Origin</option>';
                uniqueOrigins.forEach((name, icao) => {
                    const option = document.createElement('option');
                    option.value = icao;
                    option.textContent = `${icao} (${name})`;
                    originSelect.appendChild(option);
                });
            }

            // Function to populate destination dropdown
            function populateDestinationDropdown() {
                const uniqueDestinations = new Map();
                availableFlights.forEach(flight => {
                    uniqueDestinations.set(flight.destination, flight.destinationName);
                });

                destinationSelect.innerHTML = '<option value="">Select a Destination</option>';
                uniqueDestinations.forEach((name, icao) => {
                    const option = document.createElement('option');
                    option.value = icao;
                    option.textContent = `${icao} (${name})`;
                    destinationSelect.appendChild(option);
                });
            }

            // Initial population of dropdowns
            populateOriginDropdown();
            populateDestinationDropdown();

            // Event listener for form submission (removed preventDefault)
            if (flightBookingForm) {
                flightBookingForm.addEventListener('submit', (event) => {
                    // Removed event.preventDefault() to allow Formcarry submission
                    // console.log('Flight booking form submitted!'); // For debugging
                    
                    // Populate hidden Discord fields before submission
                    const savedUser = JSON.parse(localStorage.getItem("discordUser"));
                    if (savedUser) {
                        discordUsernameInput.value = savedUser.username;
                        discordIdInput.value = savedUser.id;
                    }

                    // Form will now submit naturally to Formcarry
                    // The success message div is no longer needed here as Formcarry handles success state
                });
            }


            // Discord Login Integration
            // Your Discord Client ID from the Discord Developer Portal
            const CLIENT_ID = "1396149795470446692";
            // The Redirect URI must EXACTLY match what's configured in your Discord OAuth2 settings
            const REDIRECT_URI = "https://pfiberiava.github.io/flyibe/flightbooking.html"; // Updated redirect URI for flight booking page

            // Discord authorization URL - CRITICAL: Changed response_type to 'token'
            const AUTH_URL = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=identify`;

            // Select all divs where user actions will be displayed
            const userActionsDivs = document.querySelectorAll(".user-actions");

            // Function to display user information and the logout button
            function showUser(user) {
                const avatarUrl = user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png` : 'https://discord.com/assets/f135b1fcd3d2c4935480d19e910540d5.png';
                userActionsDivs.forEach(div => {
                    div.innerHTML = `
                        <div class="user-info">
                            <img src="${avatarUrl}" alt="User Avatar">
                            <span>${user.username}</span>
                            <button class="logout-button">Logout</button>
                        </div>
                    `;
                    const logoutButton = div.querySelector(".logout-button");
                    if (logoutButton) {
                        logoutButton.onclick = () => {
                            localStorage.removeItem("discordUser");
                            window.location.href = REDIRECT_URI; // Reload to reset state and clear URL hash
                        };
                    }
                });
                // Hide login message and enable form
                if (loginRequiredMessage) loginRequiredMessage.classList.add('hidden');
                if (flightBookingForm) flightBookingForm.classList.remove('hidden');
                toggleFormFields(true);
            }

            // Function to display the Discord login button
            function showLoginButton() {
                userActionsDivs.forEach(div => {
                    div.innerHTML = `
                       <a href="${AUTH_URL}"  class="Btn">
             <span class="svgContainer">
               <svg
                 viewBox="0 0 640 512"
                 fill="white"
                 height="1.4em"
                 xmlns="http://www.w3.org/2000/svg"
               >
                 <path
                   d="M524.5 69.8a1.5 1.5 0 0 0 -.8-.7A485.1 485.1 0 0 0 404.1 32a1.8 1.8 0 0 0 -1.9 .9 337.5 337.5 0 0 0 -14.9 30.6 447.8 447.8 0 0 0 -134.4 0 309.5 309.5 0 0 0 -15.1-30.6 1.9 1.9 0 0 0 -1.9-.9A483.7 483.7 0 0 0 116.1 69.1a1.7 1.7 0 0 0 -.8 .7C39.1 183.7 18.2 294.7 28.4 404.4a2 2 0 0 0 .8 1.4A487.7 487.7 0 0 0 176 479.9a1.9 1.9 0 0 0 2.1-.7A348.2 348.2 0 0 0 208.1 430.4a1.9 1.9 0 0 0 -1-2.6 321.2 321.2 0 0 1 -45.9-21.9 1.9 1.9 0 0 1 -.2-3.1c3.1-2.3 6.2-4.7 9.1-7.1a1.8 1.8 0 0 1 1.9-.3c96.2 43.9 200.4 43.9 295.5 0a1.8 1.8 0 0 1 1.9 .2c2.9 2.4 6 4.9 9.1 7.2a1.9 1.9 0 0 1 -.2 3.1 301.4 301.4 0 0 1 -45.9 21.8 1.9 1.9 0 0 0 -1 2.6 391.1 391.1 0 0 0 30 48.8 1.9 1.9 0 0 0 2.1 .7A486 486 0 0 0 610.7 405.7a1.9 1.9 0 0 0 .8-1.4C623.7 277.6 590.9 167.5 524.5 69.8zM222.5 337.6c-29 0-52.8-26.6-52.8-59.2S193.1 219.1 222.5 219.1c29.7 0 53.3 26.8 52.8 59.2C275.3 311 251.9 337.6 222.5 337.6zm195.4 0c-29 0-52.8-26.6-52.8-59.2S388.4 219.1 417.9 219.1c29.7 0 53.3 26.8 52.8 59.2C470.7 311 447.5 337.6 417.9 337.6z"
                 ></path>
               </svg>
             </span>
             <span class="BG"></span>
           </a>
                    `;
                });
                // Display login message and disable form
                if (loginRequiredMessage) {
                    loginRequiredMessage.classList.remove('hidden');
                    // Ensure the login button is rendered inside the message div
                    const loginBtnHtml = `
                       <a href="${AUTH_URL}" class="Btn">
                           <span class="svgContainer">
                               <svg viewBox="0 0 640 512" fill="white" height="1.4em" xmlns="http://www.w3.org/2000/svg">
                                   <path d="M524.5 69.8a1.5 1.5 0 0 0 -.8-.7A485.1 485.1 0 0 0 404.1 32a1.8 1.8 0 0 0 -1.9 .9 337.5 337.5 0 0 0 -14.9 30.6 447.8 447.8 0 0 0 -134.4 0 309.5 309.5 0 0 0 -15.1-30.6 1.9 1.9 0 0 0 -1.9-.9A483.7 483.7 0 0 0 116.1 69.1a1.7 1.7 0 0 0 -.8 .7C39.1 183.7 18.2 294.7 28.4 404.4a2 2 0 0 0 .8 1.4A487.7 487.7 0 0 0 176 479.9a1.9 1.9 0 0 0 2.1-.7A348.2 348.2 0 0 0 208.1 430.4a1.9 1.9 0 0 0 -1-2.6 321.2 321.2 0 0 1 -45.9-21.9 1.9 1.9 0 0 1 -.2-3.1c3.1-2.3 6.2-4.7 9.1-7.1a1.8 1.8 0 0 1 1.9-.3c96.2 43.9 200.4 43.9 295.5 0a1.8 1.8 0 0 1 1.9 .2c2.9 2.4 6 4.9 9.1 7.2a1.9 1.9 0 0 1 -.2 3.1 301.4 301.4 0 0 1 -45.9 21.8 1.9 1.9 0 0 0 -1 2.6 391.1 391.1 0 0 0 30 48.8 1.9 1.9 0 0 0 2.1 .7A486 486 0 0 0 610.7 405.7a1.9 1.9 0 0 0 .8-1.4C623.7 277.6 590.9 167.5 524.5 69.8zM222.5 337.6c-29 0-52.8-26.6-52.8-59.2S193.1 219.1 222.5 219.1c29.7 0 53.3 26.8 52.8 59.2C275.3 311 251.9 337.6 222.5 337.6zm195.4 0c-29 0-52.8-26.6-52.8-59.2S388.4 219.1 417.9 219.1c29.7 0 53.3 26.8 52.8 59.2C470.7 311 447.5 337.6 417.9 337.6z"></path>
                               </svg>
                           </span>
                           <span class="BG"></span>
                       </a>
                    `;
                    if (loginButtonContainer) loginButtonContainer.innerHTML = loginBtnHtml;
                }
                if (flightBookingForm) flightBookingForm.classList.add('hidden');
                toggleFormFields(false);
            }

            // --- Main login state management logic ---
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const token = params.get("access_token"); // We are now expecting 'access_token'

            const savedUser = JSON.parse(localStorage.getItem("discordUser"));

            if (token) {
                // If a token is present in the URL (after a new Discord login)
                window.history.replaceState({}, document.title, REDIRECT_URI); // Clean the URL

                fetch("https://discord.com/api/users/@me", {
                    headers: {
                        Authorization: `Bearer ${token}`
                    }
                })
                .then(res => {
                    if (!res.ok) {
                        console.error("Discord API error:", res.status, res.statusText);
                        localStorage.removeItem("discordUser"); // Clear stale user data
                        showLoginButton();
                        throw new Error("Failed to fetch user data from Discord");
                    }
                    return res.json();
                })
                .then(user => {
                    if (user.id) {
                        localStorage.setItem("discordUser", JSON.stringify(user));
                        showUser(user);
                        // Populate hidden fields with Discord user info immediately after login
                        discordUsernameInput.value = user.username;
                        discordIdInput.value = user.id;
                    } else {
                        console.error("Invalid Discord user data received:", user);
                        localStorage.removeItem("discordUser");
                        showLoginButton();
                    }
                })
                .catch(error => {
                    console.error("Error during Discord user fetch or processing:", error);
                    localStorage.removeItem("discordUser");
                    showLoginButton();
                });
            } else if (savedUser) {
                showUser(savedUser);
                // Populate hidden fields with Discord user info if user is already saved
                discordUsernameInput.value = savedUser.username;
                discordIdInput.value = savedUser.id;
            } else {
                showLoginButton();
            }
        });
    </script>
</body>
</html>
